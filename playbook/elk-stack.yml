---
  - import_playbook: ../variable-check.yml
    vars:
      playbook: elk_stack.yml

  - name: Test Connection and Determine Remote User
    hosts: elk_stack
    gather_facts: false
    roles:
      - { role: connection, tags: [connection, always] }

  - hosts: elk_stack
    become: yes
    gather_facts: false
    pre_tasks: 
      - name: Install python2 for Ansible
        raw: bash -c "test -e /usr/bin/python || (apt -qqy update && apt install -qqy python-minimal)"
        register: output
        changed_when: output.stdout != ""
      - name: Gathering Facts
        setup:
    roles:
    #   - { role: common, tags: [common] }
    #   - { role: monitoring/consul, tags: [consul] }
    #   - { role: platform/java }
    #   - { role: database/elasticsearch }
    #   - { role: applications/kibana }
    #   - { role: extra/logstash }
    #   - { role: extra/filebeat }
      - { role: webservers/nginx }
    #   - { role: monitoring/netdata, tags: [netdata] }
    #   - { role: monitoring/monit, tags: [monit] }
    #   - { role: extra/swapfile, tags: [swapfile] }
    #   - { role: security/fail2ban, tags: [fail2ban] }
    #   - { role: security/ntp, tags: [ntp] }
    #   - { role: extra/sendmail, tags: [sendmail] }
    #   - { role: extra/users, tags: [users] }
    #   - { role: security/freeipa/ipaclient }
