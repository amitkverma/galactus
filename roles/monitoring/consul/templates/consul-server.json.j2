{
  "node_name": "{{ consul_nodename }}",
{% if consul_ui %}
  "ui": true,
  "addresses":{
    "http": "0.0.0.0"
  },
{% endif %}
  "data_dir": "{{ consul_datadir }}",
  "log_level": "{{ consul_loglevel }}",
  "domain": "{{ consul_domain }}",
  "datacenter": "{{ consul_datacenter }}",
  "bind_addr": "{{ ansible_all_ipv4_addresses | ipaddr('private') | first }}",
  "advertise_addr": "{{ consul_ip }}",
  "ports": {
    "http": {{ consul_http_port }},
    "dns": {{ consul_dns_port }}
  },
  "server": {{ "true" if consul_server else "false" }},
  "enable_syslog": {{ "true" if consul_syslog else "false" }},
  "enable_script_checks": {{ "true" if health_check_script_enabled is defined else "false" }},
  "retry_join": [{% for host in  ansible_all_ipv4_addresses | ipaddr('private')  %}"{{ host }}:8301"{% if not loop.last %}, {% endif %}{% endfor %}],
  "rejoin_after_leave": true,
{% if consul_server %}
  "bootstrap_expect": {{ ansible_all_ipv4_addresses | ipaddr('private') | length }}
{% endif %}
}
